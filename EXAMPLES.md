# Example Scenarios

This document shows example outputs and use cases for PRism.

## Scenario 1: Duplicate Issue Detection

### Input
A new issue is created:
```
Title: Add dark mode to the application
Body: It would be great if the app supported a dark theme for better viewing at night.
```

### Output
PRism analyzes the issue and finds similar issues. It posts a comment:

```markdown
üîç **Potential Duplicate Detected**

This issue appears to be similar to:

- [#42](https://github.com/org/repo/issues/42) - Implement dark mode support (87.5% similar)
- [#38](https://github.com/org/repo/issues/38) - Add theme switching functionality (82.3% similar)

**Analysis:**
This issue requests dark mode support, which is essentially the same feature 
requested in #42. While the wording differs, both issues are asking for the 
ability to switch between light and dark themes. Issue #38 also discusses 
theme switching which encompasses dark mode functionality.

---
*This analysis was generated by PRism AI triage.*
```

## Scenario 2: Pull Request Review

### Input
A PR is opened that adds user authentication:
```
Title: Add JWT authentication
Body: Implements JWT-based authentication with login/logout endpoints
Files: src/auth/jwt.ts, src/routes/auth.ts, tests/auth.test.ts
```

### Output
PRism analyzes the code changes and posts a review:

```markdown
## ü§ñ AI Code Review

**Summary:** This PR adds JWT-based user authentication with login and logout 
endpoints. The implementation includes proper error handling and test coverage, 
but has a critical security issue with the hardcoded JWT secret.

### Findings

#### ‚ö†Ô∏è Issues
- üî¥ **Security: JWT Secret in Code**
  The JWT secret is hardcoded in the source file. This is a critical security 
  vulnerability. The secret should be stored in environment variables and never 
  committed to the repository.
  üìÅ `src/auth/jwt.ts`:42

- üü† **Missing Input Validation**
  The login endpoint doesn't validate email format before processing. This could 
  lead to unexpected errors or security issues.
  üìÅ `src/routes/auth.ts`:28

#### üí° Suggestions
- üü° **Add Rate Limiting**
  Consider adding rate limiting to the login endpoint to prevent brute force 
  attacks. Libraries like express-rate-limit can help with this.
  üìÅ `src/routes/auth.ts`:15

- üü° **Token Refresh Mechanism**
  Consider implementing refresh tokens for better security and user experience. 
  This allows users to stay logged in without frequently re-authenticating.

#### ‚ú® Highlights
- üîµ **Well-Tested**
  Excellent test coverage with both unit and integration tests. The tests cover 
  success cases, error cases, and edge cases.

- üîµ **Good Error Handling**
  Proper error handling throughout with meaningful error messages and appropriate 
  HTTP status codes.

#### ‚ùì Questions
- üîµ **Token Expiration**
  What is the intended token expiration time? This should be documented and 
  configurable.

**Estimated Complexity:** medium

**Suggested Labels:** `security`, `authentication`, `backend`, `needs-review`

---
*This review was generated by PRism AI triage.*
```

## Scenario 3: Automatic Labeling

### Input
An issue is created:
```
Title: Button click doesn't work on mobile Safari
Body: When I click the submit button on my iPhone using Safari, nothing happens. 
Works fine on desktop and Android Chrome.
```

### Output
PRism automatically applies labels:
- `bug`
- `mobile`
- `browser-compatibility`
- `needs-investigation`

And posts a comment explaining the labeling:
```markdown
üè∑Ô∏è **Labels Applied**

The following labels have been automatically applied based on analysis:

- **bug** - The issue describes unexpected behavior (button not working)
- **mobile** - The issue is specific to mobile devices
- **browser-compatibility** - The issue occurs in Safari but not other browsers
- **needs-investigation** - Requires further investigation to identify root cause

If any labels are incorrect, please feel free to adjust them.

---
*This labeling was generated by PRism AI triage.*
```

## Scenario 4: Stateful Mode with Postgres

### Setup
Configure the action with a database URL:

```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
    database-url: ${{ secrets.DATABASE_URL }}
```

### Benefits
1. **Persistent Similarity Search**: Embeddings are stored permanently
2. **Cross-Run Duplicate Detection**: Can find duplicates from weeks/months ago
3. **Faster Performance**: pgvector enables efficient similarity queries
4. **Scalability**: Handles large repositories with thousands of issues/PRs

### Database Schema
PRism automatically creates:
```sql
CREATE TABLE prism_embeddings (
  id SERIAL PRIMARY KEY,
  key TEXT UNIQUE NOT NULL,
  item_number INTEGER NOT NULL,
  item_type TEXT NOT NULL,
  title TEXT NOT NULL,
  url TEXT NOT NULL,
  embedding vector(1536) NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX ON prism_embeddings USING ivfflat (embedding vector_cosine_ops);
```

## Scenario 5: Configuration Examples

### Minimal Configuration (Stateless)
```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
```

### Duplicate Detection Only
```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
    enable-duplicate-detection: 'true'
    enable-pr-review: 'false'
    enable-labeling: 'false'
```

### PR Review Only
```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
    enable-duplicate-detection: 'false'
    enable-pr-review: 'true'
    enable-labeling: 'false'
```

### High Sensitivity Duplicate Detection
```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
    duplicate-threshold: '0.70'  # Lower threshold = more sensitive
```

### Custom Model
```yaml
- uses: danhdox/prism@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    llm-api-key: ${{ secrets.OPENAI_API_KEY }}
    llm-model: 'gpt-4-turbo-preview'
```

## Performance Characteristics

### Stateless Mode
- **Startup**: < 5s
- **Issue Processing**: 10-30s (depending on repo size)
- **PR Processing**: 15-45s (depending on PR size)
- **Memory**: 100-500MB
- **Limitations**: Cannot find duplicates from previous runs

### Stateful Mode (with Postgres)
- **Startup**: < 10s (includes DB connection)
- **Issue Processing**: 5-15s (faster due to indexed similarity search)
- **PR Processing**: 15-45s
- **Memory**: 100-500MB
- **Limitations**: Requires database setup and maintenance

## Cost Estimation

### OpenAI API Costs (approximate)
- **Embedding Generation**: ~$0.0001 per issue/PR
- **Duplicate Detection**: ~$0.01-0.03 per analysis
- **PR Review**: ~$0.05-0.15 per review
- **Label Suggestion**: ~$0.01 per suggestion

For a typical open-source project:
- **10 issues/month**: ~$0.30
- **20 PRs/month**: ~$4.00
- **Total**: ~$4.30/month

For a high-traffic repository:
- **100 issues/month**: ~$3.00
- **200 PRs/month**: ~$40.00
- **Total**: ~$43.00/month

## Best Practices

1. **Start with stateless mode** - Test the action before setting up a database
2. **Monitor costs** - Keep an eye on your OpenAI API usage
3. **Tune thresholds** - Adjust duplicate-threshold based on false positive rate
4. **Review labels** - Ensure repository has a good set of labels before enabling auto-labeling
5. **Use appropriate models** - GPT-4 is more accurate but expensive; GPT-3.5-turbo is cheaper
6. **Set up rate limiting** - Protect your API key from abuse
7. **Regular maintenance** - Clean up old embeddings if using stateful mode

## Troubleshooting

### No comments posted
- Check that the action has `issues: write` and `pull-requests: write` permissions
- Verify the GitHub token is valid
- Check action logs for errors

### Inaccurate duplicate detection
- Adjust the `duplicate-threshold` (increase for fewer false positives)
- Ensure issue descriptions are detailed enough for comparison
- Consider upgrading to a better LLM model

### Slow performance
- Enable stateful mode with Postgres for better performance
- Reduce the number of features enabled
- Use a faster LLM model

### High costs
- Use GPT-3.5-turbo instead of GPT-4
- Disable features you don't need
- Set up stricter trigger conditions in your workflow
